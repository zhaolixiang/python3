首先需要说明的一点是，为了统计数据存储到Redis里面，笔者曾经实现过5种不同的方法，本节介绍的方法综合了这5种方法里面的众多优点，具有非常大的灵活性和可扩展性。

本节所展示的存储统计数据的方法，在工作方式上与上节介绍的log\_common\(\)函数类似：这两者存储的数据记录的都是当前这一小时以及前一小时所产生的事情。另外，本节介绍的方法会记录最小值、最大值、平均值、标准差、样本数量以及所有被记录值之和等众多信息，以便不时之需。

对于一种给定的上下文和类型，程序将使用一个有序集合来记录这个上下文以及这个类型的最小值、最大值、样本数量、值的和、值的平方之和等信息，并通过这些信息来计算平均值以及标准差。程序将值存储在有序集合里面并非是为了按照分值对成员进行排序、而是为了对存储着统计信息的有序集合和其他有序集合进行并集计算，并通过min和max这两个聚合函数来筛选相交的元素。下表展示了一个存储统计数据的有序集合实例，它记录了ProfilePage\(个人简历\)上下文的AccessTime（访问时间）统计数据。

| 表名：starts:ProfilePage:AccessTime | 类型：zset |
| :--- | :--- |
| min | 0.035 |
| max | 4.958 |
| sunsq | 194.268 |
| sum | 258.973 |
| count | 2323 |



