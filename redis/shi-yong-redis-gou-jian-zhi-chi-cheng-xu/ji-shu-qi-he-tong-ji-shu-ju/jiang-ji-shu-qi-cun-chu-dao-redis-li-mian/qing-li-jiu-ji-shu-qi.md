### 清理旧计数器

经过前面的介绍，我们已经知道了怎样将计数器存储到Redis里面，已经怎样从计数器里面取出数据。但是，如果我们只是一味地对计数器进行更新而不执行任何清理操作的话，那么程序最终将会因为存储了过多的数据而导致内存不足。好在我们事先已将所有已知的计数器记录到了一个有序集合里面，所以对计数器进行清理只需要遍历有序集合并删除其中的旧计数器旧可以了。

> 为什么不使用expire？
>
> expire命令的其中一个限制就是它只能应用整个键，而不能只对键的某一部分数据进行过期处理。并且因为我们将同一个计数器在不同精度下的所有计数器数据都存放到了同一个键里面，所以我们必须定期地对计数器进行清理。如果读者感兴趣的话，也可以试试改变计数器组织数据的方式，使用Redis的过期键功能来代替手工的清理操作。

在处理和清理旧数据的时候，有几件事情是需要我们格外留心的，其中包括以下几件：

1. 任何时候都可能会有新的计数器被添加进来
2. 同一时间可能会有多个不同的清理操作在执行
3. 对于一个每天只更新一次的计数器来说，以每分钟一次的频率尝试清理这个计数器只会浪费计算资源。
4. 如果一个计数器不包含任何数据，那么程序就不应该尝试对它进行清理。



