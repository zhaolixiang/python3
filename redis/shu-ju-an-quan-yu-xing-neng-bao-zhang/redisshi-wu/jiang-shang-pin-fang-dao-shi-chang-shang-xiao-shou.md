# 将商品放到市场上销售

为了将商品放到市场上进行销售，程序除了要使用multi命令和exec命令之外，还需要配合使用watch命令，有时候甚至还会用到unwatch和discard命令。在用户使用watch命令对键进行监视之后，直到用户执行exec命令的这段时间里面，如果有其他客户端抢先对任何被监视的键进行了替换、更新或删除等操作，那么当用户尝试执行exec命令的时候，事务将失败并返回一个错误（之后用户可以选择重试事务或者放弃事务）。通过使用watch、multi/exec、unwatch/discard等命令。程序可以在执行某些重要操作的时候，通过确保资金正在使用的数据没有发生变化来避免数据出错。

> 什么是discard？
>
> unwatch命令可以在watch命令执行之后，multi命令执行之前对连接进行重置（reset）；同样地，discard命令也可以在multi命令执行之后、exec命令执行之前对连接进行重置。这也就是说，用户在使用watch监视一个或多个键。接着使用multi开始一个新的事物，并将多个命令入队到事物队列之后，仍然可以通过发送discard命令来取消watch命令并清空所有已入队命令。本章展示的例子都没有用到discard，主要原因在于我们已经清楚的知道自己是否想要执行multi/exec或者unwatch，所以没有必要在这些例子里面使用discard。

在将一件商品放到市场上进行销售的时候，程序需要将被销售的商品添加到记录市场正在销售商品的有序集合里面，并且在添加操作执行的过程中，监视卖家的包裹以确保被销售的商品的确存在于卖家的包裹当中。

下面代码展示了这一操作的具体实现：

```

```



