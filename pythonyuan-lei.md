# Pythonå…ƒç±»

> æœ¬ç¯‡å†…å®¹åªä¾›äº†è§£ï¼Œå®é™…ä¸Š99%çš„pythonç¨‹åºå‘˜éƒ½ç”¨ä¸åˆ°å…ƒç±»å“Ÿï¼Œä¸è¿‡ä½ è¦æƒ³æˆä¸ºé‚£1%ï¼Œè¯·éšæ„äº«ç”¨ï¼Œåˆ«å®¢æ°”ğŸ˜†
>
> å…ƒç±»ä½œç”¨ï¼šæ‹¦æˆªç±»çš„åˆ›å»ºã€ä¿®æ”¹ç±»ã€è¿”å›ä¿®æ”¹ä¹‹åçš„ç±»

ä¸‡ç‰©çš†å¯¹è±¡ï¼Œç±»åˆ›å»ºäº†å®ä¾‹å¯¹è±¡ï¼Œé‚£æ—¢ç„¶ä¸‡ç‰©çš†å¯¹è±¡ï¼Œç±»ä¹Ÿæ˜¯å¯¹è±¡ï¼Œé‚£ä»€ä¹ˆåˆ›å»ºäº†ç±»å‘¢ï¼Œå•¦å•¦å•¦ï¼Œå½“ç„¶å°±æ˜¯æœ¬ç¯‡çš„ä¸»äººç¿ï¼šå…ƒç±»ã€‚

### 1ã€ç±»ä¹Ÿæ˜¯å¯¹è±¡

> æ—¢ç„¶ç±»ä¹Ÿæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œé‚£å°±åº”è¯¥å…·æœ‰å¯¹è±¡å…±æœ‰çš„ç‰¹æ€§ï¼š
>
> å¯ä»¥å°†å…¶èµ‹ç»™å˜é‡
>
> å¯ä»¥æ‹·è´
>
> å¯ä»¥å¢åŠ å±æ€§
>
> å¯ä»¥ä½œä¸ºå‡½æ•°å‚æ•°è¿›è¡Œä¼ é€’

å®ä¾‹ï¼š

```
class A:
    def hello_fun(self):
        print("Hello World")

def test(a):
    print("ç±»ä½œä¸ºå‡½æ•°å‚æ•°ä¼ é€’ï¼š",a)

#ç±»ä¹Ÿæ˜¯å¯¹è±¡ï¼Œæ‰€ä»¥å¯ä»¥æ‰“å°
print(A)

#å› ä¸ºç±»ä¹Ÿæ˜¯å¯¹è±¡ï¼Œæ‰€ä»¥å¯ä»¥ä½œä¸ºå‡½æ•°å‚æ•°è¿›è¡Œä¼ é€’
test(A)

#hasattrç”¨æ¥åˆ¤æ–­æŒ‡å®šç±»ä¸­æ˜¯æœ‰æœ‰å¯¹åº”å±æ€§
print(hasattr(A,"mark"))#å“¼ï¼Œæˆ‘å°±æ˜¯ä¸€ä¸ªå±æ€§ï¼Œæ¥æ‰“æˆ‘å‘€

#æ·»åŠ å±æ€§å¹¶ä¸”èµ‹å€¼
A.mark="å¸…"#markæ˜¯å±æ€§åç§°ï¼Œå¸…æ˜¯å€¼
print(hasattr(A,"mark"))
print("markå±æ€§å€¼ï¼š",A.mark)

#å› ä¸ºç±»æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œæ‰€ä»¥å¯ä»¥æ‹·è´
B=A#æ‹·è´
print(B)
```

è¿è¡Œç»“æœï¼š

```
<class '__main__.A'>
ç±»ä½œä¸ºå‡½æ•°å‚æ•°ä¼ é€’ï¼š <class '__main__.A'>
False
True
markå±æ€§å€¼ï¼š å¸…
<class '__main__.A'>
```

### 2ã€åŠ¨æ€ï¼ˆå‡½æ•°å†…éƒ¨ï¼‰åˆ›å»ºç±»

> æ—¢ç„¶ç±»ä¹Ÿæ˜¯å¯¹è±¡ï¼Œå½“ç„¶å¯ä»¥åŠ¨æ€åˆ›å»ºï¼Œæ¯”å¦‚åœ¨å‡½æ•°å†…éƒ¨åˆ›å»ºã€‚

å®ä¾‹ï¼š

```
def test():
    class A:
        def hello_fun(self):
            print("Hello World")
    print("å‡½æ•°å†…éƒ¨åˆ›å»ºçš„ç±»ï¼š",A)


test()
```

è¿è¡Œç»“æœï¼š

```
å‡½æ•°å†…éƒ¨åˆ›å»ºçš„ç±»ï¼š <class '__main__.test.<locals>.A'>
```

### 3ã€typeåŠ¨æ€åˆ›å»ºç±»

> typeå‡½æ•°é™¤äº†å¯ä»¥æ£€æŸ¥ç±»å‹å¤–ï¼Œå¦ä¸€ä¸ªé«˜å¤§ä¸Šçš„ç”¨é€”å°±æ˜¯åŠ¨æ€åˆ›å»ºç±»ã€‚
>
> è¯­æ³•ï¼štype\(ç±»å,ç”±çˆ¶ç±»åç§°ç»„æˆçš„å…ƒç»„ï¼ˆå¯ä»¥ä¸ºç©ºï¼‰,åŒ…å«å±æ€§çš„å­—å…¸ï¼ˆåç§°å’Œå€¼ï¼‰\)

å®ä¾‹ï¼š

```
#å®šä¹‰ä¸€ä¸ªæ²¡æœ‰æ–¹æ³•ï¼Œæ²¡æœ‰å±æ€§çš„ç±»ï¼šA
A=type("A",(),{})

#æ‰“å°A
print(A)
#æ‰“å°Açš„å®ä¾‹
print(A())

print("*"*30)

#å®šä¹‰ä¸€ä¸ªå¸¦ä¸¤ä¸ªå±æ€§çš„ç±»ï¼šB
B=type("B",(),{"name":"mark","age":18})
print(B.name)
print(B.age)

print("*"*30)

#å®šä¹‰ä¸€ä¸ªå¸¦æ™®é€šæ–¹æ³•çš„ç±»ï¼šC
def test_for_c(self):
    print(self.name)
C=type("C",(),{"name":"mark","age":18,"test_for_c":test_for_c})
c=C()
c.test_for_c()

print("*"*30)

#æ·»åŠ é™æ€æ–¹æ³•
@staticmethod
def static_method_test():
    print("static method test")
D=type("D",(),{"name":"mark","age":18,"static_method_test":static_method_test})
D.static_method_test()


print("*"*30)
#æ·»åŠ ç±»æ–¹æ³•
@classmethod
def class_method_test(cls):
    print(cls.name)
E=type("E",(),{"name":"mark","age":18,"class_method_test":class_method_test})
e=E()
e.class_method_test()
E.class_method_test()
```

ç»“æœï¼š

```
<class '__main__.A'>
<__main__.A object at 0x10b7ac0f0>
******************************
mark
18
******************************
mark
******************************
static method test
******************************
mark
mark
```

### 4ã€\_\__metaclass_\_\_

å®ä¾‹ï¼š

```
class A(object,metaclass=xxxx):
    pass
```

æ»´ç­”æ»´ç­”ï¼Œæƒ³è±¡ä¸€ä¸‹ï¼Œè§£ææŒ‡é’ˆç°åœ¨è¿è¡Œåˆ°è¿™ä¸ªç±»çš„ä¸Šé¢ï¼Œæ­¤å¤„ç±»è¿˜æ²¡åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œç„¶åå¼€å§‹è§£æAï¼Œé¦–å…ˆå»Açš„å®šä¹‰ä¸­æ‰¾ï¼Œæœ‰æ²¡æœ‰æŒ‡å®š\_\__metaclass_\_\_å±æ€§ï¼Œå¦‚æœæŒ‡å®šäº†ï¼Œå°±åˆ©ç”¨è¿™ä¸ªæŒ‡å®šçš„å±æ€§æ¥åˆ›å»ºç±»ï¼Œæ²¡æœ‰æŒ‡å®šå°±ä¼šç”¨typeå¼€ç”Ÿæˆç±»ã€‚å…·ä½“æ­¥éª¤å¦‚ä¸‹ï¼š

1. ç±»ä¸­æœ‰è¿™ä¸ª\_\__metaclass_\_\_å±æ€§å—ï¼Œå¦‚æœæœ‰ï¼Œåˆ©ç”¨è¿™ä¸ªå±æ€§æ¥åˆ›å»ºç±»ã€‚
2. å¦‚æœç±»ä¸­ä¸å­˜åœ¨ï¼Œåˆ¤æ–­çˆ¶ç±»æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœå­˜åœ¨ï¼Œå°±åˆ©ç”¨è¿™ä¸ªå±æ€§åˆ›å»ºç±»ã€‚
3. çˆ¶ç±»ä¹Ÿæ²¡æœ‰ï¼Œå°±å»æ¨¡å—å±‚æ¬¡å¯»æ‰¾è¿™ä¸ªå±æ€§ï¼Œå­˜åœ¨çš„è¯å°±åˆ©ç”¨è¿™ä¸ªå±æ€§åˆ›å»ºç±»ï¼Œ
4. å¦‚æœè¿˜æ²¡æœ‰æ‰¾åˆ°ï¼Œå°±ä½¿ç”¨typeæ¥åˆ›å»ºç±»ã€‚

### 5ã€è‡ªå®šä¹‰å…ƒç±»ï¼ˆé€šè¿‡å®šä¹‰æ–¹æ³•ï¼‰

> ç°åœ¨è‡ªå®šä¹‰ä¸€ä¸ªå…ƒç±»ï¼Œä¿è¯æ‰€æœ‰çš„å±æ€§åéƒ½å¤§å†™

å®ä¾‹ï¼š

```
def upper_attr(class_name,class_parent,class_attr):
    #éå†å±æ€§å­—å…¸ï¼ŒæŠŠä¸æ˜¯__å¼€å¤´çš„å±æ€§åç§°éƒ½ç¼–ç¨‹å¤§å†™
    newAttr={}
    for name,value in class_attr.items():
        if not name.startswith("__"):
            newAttr[name.upper()]=value
    #è°ƒç”¨typeæ¥åˆ›å»ºç±»
    return type(class_name,class_parent,newAttr)
class A(object,metaclass=upper_attr):
    mark="å¸…å“¥"

print(hasattr(A,"mark"))
print(hasattr(A,"MARK"))

print(A.MARK)
```

ç»“æœï¼š

```
False
True
å¸…å“¥
```

### 6ã€è‡ªå®šä¹‰å…ƒç±»ï¼ˆé€šè¿‡ç»§æ‰¿typeï¼‰

> ç°åœ¨è‡ªå®šä¹‰ä¸€ä¸ªå…ƒç±»ï¼Œä¿è¯æ‰€æœ‰çš„å±æ€§åéƒ½å¤§å†™

å®ä¾‹ï¼š

```
class UpperAttrMetaClass(type):
    #__new__æ˜¯åœ¨__init__ä¹‹å‰è¢«è°ƒç”¨çš„ç‰¹æ®Šæ–¹æ³•ï¼Œç”¨æ¥åˆ›å»ºå¯¹è±¡å¹¶è¿”å›ï¼Œ
    #è€Œ__init__åªæ˜¯å°†ä¼ é€’çš„å‚æ•°èµ‹ç»™å¯¹è±¡
    def __new__(cls,class_name,class_parent,class_attr):
        # éå†å±æ€§å­—å…¸ï¼ŒæŠŠä¸æ˜¯__å¼€å¤´çš„å±æ€§åç§°éƒ½ç¼–ç¨‹å¤§å†™
        newAttr = {}
        for name, value in class_attr.items():
            if not name.startswith("__"):
                newAttr[name.upper()] = value
        # æ–¹æ³•1ï¼šè°ƒç”¨typeæ¥åˆ›å»ºç±»
        #return type(class_name, class_parent, newAttr)

        #æ–¹æ³•2ï¼šå¤ç”¨type.__new__æ–¹æ³•
        #return type.__new__(cls,class_name,class_parent,newAttr)

        #æ–¹æ³•3ï¼šä½¿ç”¨superæ–¹æ³•
        return super(UpperAttrMetaClass,cls).__new__(cls,class_name,class_parent,newAttr)



class A(object,metaclass=UpperAttrMetaClass):
    mark="å¸…å“¥"

print(hasattr(A,"mark"))
print(hasattr(A,"MARK"))

print(A.MARK)
```

ç»“æœï¼š

```
False
True
å¸…å“¥
```



