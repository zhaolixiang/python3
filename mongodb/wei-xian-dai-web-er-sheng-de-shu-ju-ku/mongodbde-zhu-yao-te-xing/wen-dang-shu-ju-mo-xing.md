# 文档数据模型

MongoDB的数据模型是面向文档的。如果你不熟悉数据库中文档的概念，那么我们最好先看一个例子。

![](/assets/Jietu20181204-170857.jpg)上面代码是一个示例文档，表示社交新闻网站上的以票据文章，如你所见，文档基本上是一组属性名和属性值的集合。属性的值可以是简单的数据类型，例如字符串、数字和日期。但这些值也可以是数组，甚至是其他文档，这让文档可以表示各种富数据结构。在示例文档中有一个属性tags，其中用数组的形式保存了文章的标签。更有趣的是commonts属性，它是一个评论文档的数组。

让我们花点时间把它和标准关系型数据库中相同数据的表述对比一下。下图是一个对应的关系型数据库的表述。既然数据表本质上来说是偏平的，那么要表示多个一对多关系就需要多张表。先从包含每篇文章核心信息的posts表开始，然后创建三张其他的表，每个表都包含了一个post\_id字段指向原始的文章。这种将对象的数据拆分到多张表里的技术成为正规化。排除其他因素，正规化的数据集可以保证每个数据单元近出现在一个地方。

![](/assets/Jietu20181204-170924.jpg)但严格的正规化是有代价的，特别是需要一些装配工作。为了显示我们刚刚提到的文章，需要在posts和tags表之间执行联结操作。还需要单独查询评论，或者也把它们放在一个join语句里。最终，是否需要严格正规化要取决于所建模的数据的类型，在第四章我会更深入的讨论这个问题。这里重点说一下，面向文档的数据模型很容易以聚合的形式来标识数据，让你能彻底和对象打交道：所以用来表示一篇文章的数据，从评论到标签，都放进一个单独的数据库对象里。

你可能已经注意到，除了提供丰富的结构，文档无需预定义Schema。在关系型数据库中存储的是数据表中的行，每张表都有严格定义的Schema，规定了列和类型。如果表中的某一行需要一个额外的字段，那么就不得不显示的修改表结构。MongoDB把文档组织成集合，这种容器无需任何类型的Schema。理论上，集合中的每个文档都拥有完全不同的结构，在实践中，一个集合里的文档相对统一，举例来说，文档集合里的文档都有表示标题、标签、评论等内容的字段。

这种做法带来了一定的优势，首先是应用程序，而非数据库在保证数据结构。在Schema频繁变化的初级开发阶段，这能提升应用程序的开发效率。其次，更重要的是无Schema的模型允许用真正的可变属性来表示数据。举例来说，假设正在构建一个电子商务产品编号，没办法事先知道产品会有什么属性，因此应用程序需要处理这种可变性。在固定Schema的数据库中，传统的解决方案是使用【实体-属性-值】模式，如下图所示，你所看到的内容选自Magento的数据模型，这是一个开源的电子商务框架。请注意，这些数据表基本上是一样的，value字段除外，该字段仅根据数据类型的变化。该结构允许管理员定义附件的产品类型和属性，但却带来了很大的复杂性。试想打开MySQL Shell检查或更新一个用这种方式建模的产品，用于装配该产品的联结语句是何等复杂。以文档的方式建模，就不用做联结，还可以动态添加新属性。

![](/assets/Jietu20181205-163524.jpg)

